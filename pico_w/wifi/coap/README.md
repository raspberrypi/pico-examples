# Setup

These examples require libcoap and tinydtls to work. Clone these repos somewhere,,,

```
git clone https://github.com/obgm/libcoap.git
git submodule update --init
```

You can define these paths in environment variables or pass the names to cmake

```
export LIB_COAP_DIR=/home/pi/libcoap
export LIB_TINYDTLS_DIR=/home/pi/tinydtls
```

You also need to define the coap server in another environment variable...

```
export COAP_SERVER=myhost
```

The examples use keys generated by a script in the certs folder...

```
cd certs
./makecerts.sh
```

The code should now build.
tinydtls and this example currently only supports raw public keys.

```
cd libcoap
mkdir build
cd build
cmake .. -DDTLS_BACKEND=tinydtls
make -j8
```

# Coap Client

To test the client you need a server to talk to. The libcoap library comes with the coap-server example that should work.
server.key is generated by the makecerts.sh script above.

```
coap-server -M server.key -v 7
```

The coap client example requests "coap://<COAP_SERVER>/.well-known/core" and subscribes to "coap://<COAP_SERVER>/time" and coap://<COAP_SERVER>/subscribe?123/led

# Coap Server

The coap server example supports the following...

* Find out what requests it supports: coap-client -M client.key -m get coaps://$COAP_SERVER/.well-known/core
* Get the current temperature: coap-client -M client.key -m get coaps://$COAP_SERVER/temp
* Get the current led state: coap-client -M client.key -m get coaps://$COAP_SERVER/led
* Turn the led on: coap-client -M client.key -m put coaps://$COAP_SERVER/led -e 1
* Subscribe to temperature changes: coap-client -M client.key -m get coaps://$COAP_SERVER/temp -s 60 -w
* Get time: coap-client -M client.key -m get coaps://$COAP_SERVER/time

$COAP_SERVER is the name of the coap server.
client.key is generated by the makecerts.sh script above.
